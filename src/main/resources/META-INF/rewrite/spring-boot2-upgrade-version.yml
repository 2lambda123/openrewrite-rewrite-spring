# 
# Copyright 2020 the original author or authors.
# <p>
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://www.apache.org/licenses/LICENSE-2.0
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
---
########################################################################################################################
# SpringBoot 2.1
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.UpgradeToSpringBoot2MajorVersion1
displayName: Upgrade to Spring Boot 2.1
description: 'Updates maven project pom to SpringBoot 2.1.x, and applies the existing migration recipes to upgrade from 2.0 to 2.1.'
recipeList:
  # Upgrade 2.1.x from 2.0.x
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      newVersion: 2.1.x
      trustParent: true
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.1.x

  # Update properties
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion1Migrations

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion1Migrations
displayName: Migrate to Spring Boot 2.1
description: 'Applies the existing migration recipes and property updates to upgrade from Spring Boot 2.0 to 2.1.'

recipeList:
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_1

---
########################################################################################################################
# SpringBoot 2.2
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.UpgradeToSpringBoot2MajorVersion2
displayName: Upgrade to Spring Boot 2.2
description: 'Updates maven project pom to SpringBoot 2.2.x, and applies the existing migration recipes to upgrade from 2.1 to 2.2.'

recipeList:
  # Upgrade to 2.2.x from 2.1.x
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      newVersion: 2.2.x
      trustParent: true
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.2.x

  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion2Migrations

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion2Migrations
displayName: Migrate to Spring Boot 2.2
description: 'Applies the existing migration recipes and property updates to upgrade from Spring Boot 2.1 to 2.2.'
recipeList:
  # Apply previous 2.x migrations
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion1Migrations
  # 2.4 Migrations
  - org.openrewrite.java.spring.boot2.MigrateAbstractHealthIndicatorToPingHealthIndicator
  - org.openrewrite.java.spring.boot2.MigrateWebTestClientBuilderCustomizerPackageName
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_2

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateAbstractHealthIndicatorToPingHealthIndicator
displayName: Use `PingHealthIndicator`
description: '`org.springframework.boot.actuate.health.AbstractHealthIndicator` was deprecated in 2.2.'
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.actuate.health.AbstractHealthIndicator
      newFullyQualifiedTypeName: org.springframework.boot.actuate.health.PingHealthIndicator

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateWebTestClientBuilderCustomizerPackageName
displayName: Use `WebTestClientBuilderCustomizer`
description: '`org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientBuilderCustomizer` was deprecated in 2.2.'
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientBuilderCustomizer
      newFullyQualifiedTypeName: org.springframework.boot.test.web.reactive.server.WebTestClientBuilderCustomizer

---
########################################################################################################################
# SpringBoot 2.3
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.UpgradeToSpringBoot2MajorVersion3
displayName: Upgrade to Spring Boot 2.3
description: 'Updates maven project pom to SpringBoot 2.3.x, and applies the existing migration recipes to upgrade from 2.2 to 2.3.'
recipeList:
  # Upgrade to 2.3.x from 2.2.x
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      newVersion: 2.3.x
      trustParent: true
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.3.x

  # Upgrade to 2.2.x from 2.1.x
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion3Migrations

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion3Migrations
displayName: Migrate to Spring Boot 2.3
description: 'Applies the existing migration recipes and property updates to upgrade from Spring Boot 2.2 to 2.3.'
recipeList:
  # Apply previous 2.x migrations
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion2Migrations
  # 2.4 Migrations
  - org.openrewrite.java.spring.boot2.MigrateRestClientBuilderCustomizerPackageName
  - org.openrewrite.java.spring.boot2.MigrateErrorPropertiesIncludeStackTraceConstants
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_3

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateRestClientBuilderCustomizerPackageName
displayName: Use `RestClientBuilderCustomizer`
description: '`org.springframework.boot.autoconfigure.elasticsearch.rest.RestClientBuilderCustomizer` was deprecated in 2.3.'
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.autoconfigure.elasticsearch.rest.RestClientBuilderCustomizer
      newFullyQualifiedTypeName: org.springframework.boot.autoconfigure.elasticsearch.RestClientBuilderCustomizer

########################################################################################################################
# SpringBoot 2.4
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.UpgradeToSpringBoot2MajorVersion4
displayName: Upgrade to Spring Boot 2.4
description: 'Updates maven project pom to SpringBoot 2.4.x, and applies the existing migration recipes to upgrade from 2.3 to 2.4.'
recipeList:
  # Upgrade to 2.4.x from 2.3.x
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      newVersion: 2.4.x
      trustParent: true
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.4.x

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion4Migrations

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion4Migrations
displayName: Migrate to Spring Boot 2.4
description: 'Applies the existing migration recipes and property updates to upgrade from Spring Boot 2.3 to 2.4.'
recipeList:
  # Apply previous 2.x migrations
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion3Migrations
  # JUnit Jupiter's vintage engine was removed in Spring Boot 2.4
  - org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration
  - org.openrewrite.java.testing.junit5.JUnit5BestPractices
  # 2.4 Migrations
  - org.openrewrite.java.spring.framework.UpgradeToSpringFramework5MajorVersion3
  - org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactoryIsEagerInitFilters
  - org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactorySetEagerInitFilters
  - org.openrewrite.java.spring.boot2.MigrateLoggingSystemPropertyConstants
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_4

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactoryIsEagerInitFilters
displayName: Use `isEagerFilterInit()`
description: '`org.springframework.boot.web.embedded.undertow.UndertowServletWebServerFactory#isEagerInitFilters` was deprecated in 2.4 and are removed in 2.6.'
recipeList:
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.boot.web.embedded.undertow.UndertowServletWebServerFactory isEagerInitFilters()
      newMethodName: isEagerFilterInit

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactorySetEagerInitFilters
displayName: Use `setEagerFilterInit(boolean)`
description: '`org.springframework.boot.web.embedded.undertow.UndertowServletWebServerFactory#setEagerInitFilters` was deprecated in 2.4 and are removed in 2.6.'
recipeList:
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.boot.web.embedded.undertow.UndertowServletWebServerFactory setEagerInitFilters(boolean)
      newMethodName: setEagerFilterInit

########################################################################################################################
# SpringBoot 2.5
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.UpgradeToSpringBoot2MajorVersion5
displayName: Upgrade to Spring Boot 2.5
description: 'Updates maven project pom to SpringBoot 2.5.x, and applies the existing migration recipes to upgrade from 2.4 to 2.5.'
recipeList:
  # Upgrade to 2.5.x from 2.4.x
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      newVersion: 2.5.x
      trustParent: true
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.5.x

  - org.openrewrite.java.spring.boot2.ApplyMajorVersion5Migrations

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion5Migrations
displayName: Migrate to Spring Boot 2.5
description: 'Applies the existing migration recipes and property updates to upgrade from Spring Boot 2.4 to 2.5.'
recipeList:
  # Apply previous 2.x migrations
  - org.openrewrite.java.spring.boot2.ApplySpringBoot2MajorVersion4Migrations
  # 2.5 Migrations
  - org.openrewrite.java.spring.boot2.MigrateEntityManagerFactoryDependsOnPostProcessorCustomizerPackageName
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_5

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.boot2.MigrateEntityManagerFactoryDependsOnPostProcessorCustomizerPackageName
displayName: Use `EntityManagerFactoryDependsOnPostProcessor`
description: '`org.springframework.boot.autoconfigure.data.jpa.EntityManagerFactoryDependsOnPostProcessor` was deprecated in 2.5 for removal in 2.7.'
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.autoconfigure.data.jpa.EntityManagerFactoryDependsOnPostProcessor
      newFullyQualifiedTypeName: org.springframework.boot.autoconfigure.orm.jpa.EntityManagerFactoryDependsOnPostProcessor
